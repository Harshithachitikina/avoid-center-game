<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Avoid Center ‚Äì Hard Mode with Music</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: linear-gradient(#e0f7fa, #ffe0b2);
  font-family: Arial, sans-serif;
}

canvas { display: block; }

#ui {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 18px;
}

.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
  text-align: center;
  flex-direction: column;
}

button {
  margin-top: 15px;
  padding: 10px 20px;
  font-size: 18px;
}
</style>
</head>

<body>

<div id="startScreen" class="overlay">
  TAP / CLICK TO START
</div>

<div id="levelScreen" class="overlay" style="display:none;">
  <div id="levelText"></div>
  <button id="nextBtn">NEXT LEVEL</button>
</div>

<div id="gameOverScreen" class="overlay" style="display:none;">
  <div id="gameOverText"></div>
  <button onclick="location.reload()">RESTART</button>
</div>

<div id="ui">Level: 1 | Remaining: 0 | Score: 0</div>
<canvas id="game"></canvas>

<script>
/* ================= SETUP ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const ui = document.getElementById("ui");

const startScreen = document.getElementById("startScreen");
const levelScreen = document.getElementById("levelScreen");
const gameOverScreen = document.getElementById("gameOverScreen");
const levelText = document.getElementById("levelText");
const gameOverText = document.getElementById("gameOverText");
const nextBtn = document.getElementById("nextBtn");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

/* ================= AUDIO ================= */
let audioCtx;
let musicOsc;
let musicGain;

function initAudio() {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  // Background music (soft)
  musicOsc = audioCtx.createOscillator();
  musicGain = audioCtx.createGain();

  musicOsc.type = "sine";
  musicOsc.frequency.value = 120;   // calm background tone
  musicGain.gain.value = 0.05;      // low volume

  musicOsc.connect(musicGain);
  musicGain.connect(audioCtx.destination);
  musicOsc.start();
}

function playGameOverSound() {
  const o = audioCtx.createOscillator();
  o.type = "square";
  o.frequency.value = 200;
  o.connect(audioCtx.destination);
  o.start();
  setTimeout(() => o.stop(), 400);
}

/* ================= CENTER ================= */
const center = {
  x: () => canvas.width / 2,
  y: () => canvas.height / 2,
  r: 26
};

/* ================= LEVEL DATA ================= */
const levels = [
  { count: 5 },
  { count: 8 },
  { count: 12 },
  { count: 16 },
  { count: 20 },
  { count: 25 }
];

function getDifficulty(level) {
  return {
    speed: 1.5 + level * 0.6,
    gapSize: Math.max(0.45, 1.6 - level * 0.18),
    shapeSize: Math.max(45, 70 - level * 3)
  };
}

/* ================= GAME STATE ================= */
let level = 0;
let remaining = 0;
let score = 0;
let currentShape = null;
let gameOver = false;

/* ================= INPUT ================= */
document.addEventListener("mousemove", e => {
  if (currentShape) currentShape.x = e.clientX;
});

document.addEventListener("touchmove", e => {
  e.preventDefault();
  if (currentShape) currentShape.x = e.touches[0].clientX;
}, { passive: false });

/* ================= SHAPE ================= */
function createShape() {
  const types = ["ring", "bar", "cross", "triangle", "arc"];
  const type = types[Math.floor(Math.random() * types.length)];
  const diff = getDifficulty(level + 1);

  return {
    type,
    x: center.x(),
    y: -80,
    size: diff.shapeSize,
    speed: diff.speed,
    angle: Math.random() * Math.PI,
    gapStart: Math.random() * Math.PI * 2,
    gapSize: diff.gapSize
  };
}

/* ================= COLLISION ================= */
function hit(s) {
  const dx = s.x - center.x();
  const dy = s.y - center.y();
  return Math.sqrt(dx * dx + dy * dy) < s.size - center.r;
}

/* ================= DRAW SHAPE ================= */
function drawShape(s) {
  ctx.save();
  ctx.translate(s.x, s.y);
  ctx.rotate(s.angle);
  ctx.strokeStyle = "#333";
  ctx.lineWidth = 10;
  ctx.beginPath();

  switch (s.type) {
    case "ring":
      ctx.arc(0, 0, s.size, s.gapStart, s.gapStart + s.gapSize);
      break;
    case "bar":
      ctx.moveTo(-s.size, 0);
      ctx.lineTo(s.size, 0);
      break;
    case "cross":
      ctx.moveTo(-s.size, 0);
      ctx.lineTo(s.size, 0);
      ctx.moveTo(0, -s.size);
      ctx.lineTo(0, s.size);
      break;
    case "triangle":
      ctx.moveTo(0, -s.size);
      ctx.lineTo(-s.size, s.size);
      ctx.lineTo(s.size, s.size);
      ctx.closePath();
      break;
    case "arc":
      ctx.arc(0, 0, s.size, Math.PI * 0.4, Math.PI * 1.1);
      break;
  }

  ctx.stroke();
  ctx.restore();
}

/* ================= GAME LOOP ================= */
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.beginPath();
  ctx.arc(center.x(), center.y(), center.r, 0, Math.PI * 2);
  ctx.strokeStyle = "#fff";
  ctx.lineWidth = 4;
  ctx.stroke();

  if (!currentShape && remaining > 0) {
    currentShape = createShape();
    remaining--;
  }

  if (currentShape) {
    currentShape.y += currentShape.speed;
    currentShape.angle += 0.01;
    drawShape(currentShape);

    if (hit(currentShape)) {
      gameOver = true;
      playGameOverSound();
    }

    if (currentShape.y > canvas.height + 120) {
      score += 10;
      currentShape = null;
    }
  }

  ui.textContent =
    `Level: ${level + 1} | Remaining: ${remaining} | Score: ${score}`;

  if (!gameOver) {
    if (remaining === 0 && !currentShape) {
      const bonus = (level + 1) * 50;
      score += bonus;
      levelText.innerHTML =
        `LEVEL ${level + 1} COMPLETE üéâ<br>
         Bonus: +${bonus}<br>
         Score: ${score}`;
      levelScreen.style.display = "flex";
      return;
    }
    requestAnimationFrame(loop);
  } else {
    gameOverText.innerHTML =
      `GAME OVER ‚ùå<br>
       Final Score: ${score}<br>
       Level Reached: ${level + 1}`;
    gameOverScreen.style.display = "flex";
  }
}

/* ================= FLOW ================= */
function startLevel() {
  currentShape = null;
  remaining = levels[level].count;
  levelScreen.style.display = "none";
  gameOverScreen.style.display = "none";
  loop();
}

startScreen.onclick = () => {
  initAudio();          // üîä music starts here
  startScreen.style.display = "none";
  startLevel();
};

nextBtn.onclick = () => {
  level++;
  if (level >= levels.length) {
    alert(`üéâ YOU COMPLETED ALL LEVELS!\nFINAL SCORE: ${score}`);
    location.reload();
  }
  startLevel();
};
</script>

</body>
</html>
