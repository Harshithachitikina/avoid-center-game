<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Avoid the Center</title>

<meta name="viewport"
content="width=device-width, height=device-height,
initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: linear-gradient(#e0f7fa, #ffe0b2);
  font-family: Arial, sans-serif;
}

canvas { display: block; }

#ui {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 18px;
  background: rgba(255,255,255,0.85);
  padding: 6px 12px;
  border-radius: 8px;
}

.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
  text-align: center;
  flex-direction: column;
}

button {
  margin-top: 15px;
  padding: 10px 20px;
  font-size: 18px;
}
</style>
</head>

<body>

<div id="startScreen" class="overlay">TAP / CLICK TO START</div>

<div id="levelScreen" class="overlay" style="display:none;">
  <div id="levelText"></div>
  <button id="nextBtn">NEXT LEVEL</button>
</div>

<div id="gameOverScreen" class="overlay" style="display:none;">
  <div id="gameOverText"></div>
  <button onclick="location.reload()">RESTART</button>
</div>

<div id="ui">Level: 1 | Remaining: 0 | Score: 0</div>
<canvas id="game"></canvas>

<script>
/* =============== DEVICE CHECK (IMPORTANT) =============== */
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

/* ================= CANVAS ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  const dpr = window.devicePixelRatio || 1;
  canvas.style.width = window.innerWidth + "px";
  canvas.style.height = window.innerHeight + "px";
  canvas.width = window.innerWidth * dpr;
  canvas.height = window.innerHeight * dpr;
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
}
resize();
window.addEventListener("resize", resize);

/* ================= UI ================= */
const ui = document.getElementById("ui");
const startScreen = document.getElementById("startScreen");
const levelScreen = document.getElementById("levelScreen");
const gameOverScreen = document.getElementById("gameOverScreen");
const levelText = document.getElementById("levelText");
const gameOverText = document.getElementById("gameOverText");
const nextBtn = document.getElementById("nextBtn");

/* ================= AUDIO ================= */
let audioCtx, bgOsc, bgGain;

function initAudio() {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  bgOsc = audioCtx.createOscillator();
  bgGain = audioCtx.createGain();

  bgOsc.type = "sine";
  bgOsc.frequency.value = 120;
  bgGain.gain.value = 0.035;

  bgOsc.connect(bgGain);
  bgGain.connect(audioCtx.destination);
  bgOsc.start();
}

function playGameOverSound() {
  const o = audioCtx.createOscillator();
  o.frequency.value = 180;
  o.type = "square";
  o.connect(audioCtx.destination);
  o.start();
  setTimeout(() => o.stop(), 400);
}

/* ================= CENTER ================= */
const center = {
  x: () => canvas.width / (window.devicePixelRatio || 1) / 2,
  y: () => canvas.height / (window.devicePixelRatio || 1) / 2,
  r: 26
};

/* ================= GAME DATA ================= */
const levels = [5, 8, 12, 16, 20];
let level = 0;
let remaining = 0;
let score = 0;
let currentShape = null;
let gameOver = false;

/* ================= INPUT ================= */
document.addEventListener("mousemove", e => {
  if (currentShape) currentShape.x = e.clientX;
});

document.addEventListener("touchmove", e => {
  if (currentShape) currentShape.x = e.touches[0].clientX;
}, { passive: false });

/* ================= SHAPE FACTORY ================= */
function createShape() {
  const types = ["ring", "bar", "cross", "triangle", "arc"];
  const type = types[Math.floor(Math.random() * types.length)];

  const baseSpeed = isMobile ? 4.5 : 3.2;   // üöÄ MOBILE BOOST

  return {
    type,
    x: center.x(),
    y: -120,
    size: 65 - level * 3,
    speed: baseSpeed + level * 1.3,
    angle: Math.random() * Math.PI,
    gapStart: Math.random() * Math.PI * 2,
    gapSize: Math.max(0.5, 1.4 - level * 0.25)
  };
}

/* ================= COLLISION ================= */
function hit(s) {
  const dx = s.x - center.x();
  const dy = s.y - center.y();
  return Math.sqrt(dx * dx + dy * dy) < s.size - center.r;
}

/* ================= DRAW ================= */
function drawShape(s) {
  ctx.save();
  ctx.translate(s.x, s.y);
  ctx.rotate(s.angle);
  ctx.strokeStyle = "#333";
  ctx.lineWidth = 10;
  ctx.beginPath();

  switch (s.type) {
    case "ring":
      ctx.arc(0, 0, s.size, s.gapStart, s.gapStart + s.gapSize);
      break;
    case "bar":
      ctx.moveTo(-s.size, 0);
      ctx.lineTo(s.size, 0);
      break;
    case "cross":
      ctx.moveTo(-s.size, 0);
      ctx.lineTo(s.size, 0);
      ctx.moveTo(0, -s.size);
      ctx.lineTo(0, s.size);
      break;
    case "triangle":
      ctx.moveTo(0, -s.size);
      ctx.lineTo(-s.size, s.size);
      ctx.lineTo(s.size, s.size);
      ctx.closePath();
      break;
    case "arc":
      ctx.arc(0, 0, s.size, Math.PI * 0.3, Math.PI * 1.2);
      break;
  }

  ctx.stroke();
  ctx.restore();
}

/* ================= GAME LOOP ================= */
let lastTime = 0;

function loop(time) {
  const delta = (time - lastTime) / 16.6;
  lastTime = time;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.beginPath();
  ctx.arc(center.x(), center.y(), center.r, 0, Math.PI * 2);
  ctx.strokeStyle = "#fff";
  ctx.lineWidth = 4;
  ctx.stroke();

  if (!currentShape && remaining > 0) {
    currentShape = createShape();
    remaining--;
  }

  if (currentShape) {
    currentShape.y += currentShape.speed * delta;
    currentShape.angle += 0.02 + level * 0.006;
    drawShape(currentShape);

    if (hit(currentShape)) {
      gameOver = true;
      playGameOverSound();
    }

    if (currentShape.y > canvas.height + 150) {
      score += 10;
      currentShape = null;
    }
  }

  ui.textContent =
    `Level: ${level + 1} | Remaining: ${remaining} | Score: ${score}`;

  if (!gameOver) {
    if (remaining === 0 && !currentShape) {
      levelText.innerHTML =
        `LEVEL ${level + 1} COMPLETE üéâ<br>Score: ${score}`;
      levelScreen.style.display = "flex";
      return;
    }
    requestAnimationFrame(loop);
  } else {
    gameOverText.innerHTML =
      `GAME OVER ‚ùå<br>Score: ${score}`;
    gameOverScreen.style.display = "flex";
  }
}

/* ================= FLOW ================= */
function startLevel() {
  remaining = levels[level];
  currentShape = null;
  levelScreen.style.display = "none";
  gameOverScreen.style.display = "none";
  requestAnimationFrame(loop);
}

startScreen.onclick = () => {
  initAudio();           // üéµ start music
  startScreen.style.display = "none";
  startLevel();
};

nextBtn.onclick = () => {
  level++;
  if (level >= levels.length) {
    alert("üéâ YOU COMPLETED ALL LEVELS!");
    location.reload();
  }
  startLevel();
};
</script>

</body>
</html>

