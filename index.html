<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Avoid the Center</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
html, body {
  margin: 0;
  overflow: hidden;
  background: linear-gradient(#e0f7fa, #ffe0b2);
  font-family: Arial, sans-serif;
}
canvas { display:block; }

#ui {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 16px;
  font-weight: bold;
  background: rgba(255,255,255,0.85);
  padding: 6px 12px;
  border-radius: 8px;
}

#msg {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 32px;
  font-weight: bold;
  opacity: 0;
  transition: opacity 0.3s;
}
</style>
</head>

<body>

<div id="ui">Level: 1 | Score: 0 | Coins: 0</div>
<div id="msg"></div>
<canvas id="game"></canvas>

<script>
/* ========= SETUP ========= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const ui = document.getElementById("ui");
const msg = document.getElementById("msg");

let width, height;
function resize() {
  const dpr = devicePixelRatio || 1;
  width = innerWidth;
  height = innerHeight;
  canvas.style.width = width + "px";
  canvas.style.height = height + "px";
  canvas.width = width * dpr;
  canvas.height = height * dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
resize();
addEventListener("resize", resize);

/* ========= CENTER ========= */
const center = {
  x: () => width / 2,
  y: () => height / 2,
  r: 28
};

/* ========= GAME STATE ========= */
let level = 1;
let score = 0;
let coins = 0;

let currentShape = null;
let gameOver = false;
let lastTime = 0;

/* HELP SYSTEM */
let failCount = 0;
let shield = false;

/* ========= INPUT ========= */
canvas.addEventListener("mousemove", e => {
  if (currentShape) currentShape.x = e.clientX;
});
canvas.addEventListener("touchmove", e => {
  e.preventDefault();
  if (currentShape) currentShape.x = e.touches[0].clientX;
},{passive:false});

/* ========= SPEED ========= */
function speedByLevel() {
  if (level <= 3) return 2.5;
  if (level <= 7) return 3.6;
  return 4.5 + level * 0.25;
}

/* ========= CREATE SHAPE ========= */
function createShape() {
  const types = ["ring","bar","cross","triangle"];
  return {
    type: types[Math.floor(Math.random()*types.length)],
    x: center.x(),
    y: -120,
    size: 70,
    speed: speedByLevel(),
    angle: Math.random()*Math.PI
  };
}

/* ========= COLLISION ========= */
function hit(shape) {
  const dx = shape.x - center.x();
  const dy = shape.y - center.y();
  return Math.sqrt(dx*dx + dy*dy) < shape.size - center.r;
}

/* ========= DRAW ========= */
function drawShape(s) {
  ctx.save();
  ctx.translate(s.x,s.y);
  ctx.rotate(s.angle);
  ctx.lineWidth = 10;
  ctx.strokeStyle = "#333";
  ctx.beginPath();

  if (s.type==="ring") ctx.arc(0,0,s.size,0,Math.PI*1.4);
  if (s.type==="bar"){ ctx.moveTo(-60,0); ctx.lineTo(60,0); }
  if (s.type==="cross"){
    ctx.moveTo(-60,0); ctx.lineTo(60,0);
    ctx.moveTo(0,-60); ctx.lineTo(0,60);
  }
  if (s.type==="triangle"){
    ctx.moveTo(0,-60);
    ctx.lineTo(-60,60);
    ctx.lineTo(60,60);
    ctx.closePath();
  }

  ctx.stroke();
  ctx.restore();
}

/* ========= MESSAGE ========= */
function show(text) {
  msg.innerText = text;
  msg.style.opacity = 1;
  setTimeout(()=>msg.style.opacity=0, 900);
}

/* ========= RESET SHAPE SAFELY ========= */
function resetShape() {
  currentShape = null;
  gameOver = false;
}

/* ========= GAME LOOP ========= */
function loop(time) {
  const delta = (time - lastTime) / 16.6;
  lastTime = time;

  ctx.clearRect(0,0,width,height);

  /* Center */
  ctx.beginPath();
  ctx.arc(center.x(),center.y(),center.r,0,Math.PI*2);
  ctx.strokeStyle = shield ? "#44bd32" : "#fff";
  ctx.lineWidth = 4;
  ctx.stroke();

  /* ALWAYS ENSURE SHAPE EXISTS */
  if (!currentShape && !gameOver) {
    currentShape = createShape();
  }

  if (currentShape && !gameOver) {
    currentShape.y += currentShape.speed * delta;
    currentShape.angle += 0.02;
    drawShape(currentShape);

    if (hit(currentShape)) {
      if (shield) {
        shield = false;
        resetShape();
      } else {
        gameOver = true;
        failCount++;
        show("GAME OVER");

        setTimeout(() => {
          resetShape();

          if (failCount >= 2) {
            shield = true;
            show("SHIELD ACTIVATED");
            failCount = 0;
          }
        }, 1000);
      }
    }

    if (currentShape && currentShape.y > height + 120) {
      resetShape();
      score += 10;

      if (score % 100 === 0) {
        level++;
        show("AWESOME!");

        if (level % 10 === 0) {
          coins += 10;
          show("+10 COINS");
        }
      }
    }
  }

  ui.innerText = `Level: ${level} | Score: ${score} | Coins: ${coins}`;
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
